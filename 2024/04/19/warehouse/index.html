<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="x5-fullscreen" content="true">
<meta name="full-screen" content="yes">
<meta name="theme-color" content="#317EFB" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=0" name="viewport">
<meta name="description" content="基础后端搭建整合mybatis步骤 引入依赖，在pom.xml中引入mysql驱动等  123456789101112&lt;!--mybatis的依赖--&gt;&lt;dependency&gt;    &lt;groupId&gt;org.mybatis.spring.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;mybatis-spring-boot-">
<meta property="og:type" content="article">
<meta property="og:title" content="动力恒合仓库项目1">
<meta property="og:url" content="https://right-l.github.io/2024/04/19/warehouse/index.html">
<meta property="og:site_name" content="沈池の博客">
<meta property="og:description" content="基础后端搭建整合mybatis步骤 引入依赖，在pom.xml中引入mysql驱动等  123456789101112&lt;!--mybatis的依赖--&gt;&lt;dependency&gt;    &lt;groupId&gt;org.mybatis.spring.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;mybatis-spring-boot-">
<meta property="og:locale">
<meta property="og:image" content="https://right-l.github.io/img/404.jpg">
<meta property="og:image" content="https://right-l.github.io/img/404.jpg">
<meta property="og:image" content="https://right-l.github.io/img/404.jpg">
<meta property="article:published_time" content="2024-04-19T14:36:05.500Z">
<meta property="article:modified_time" content="2024-04-19T14:37:07.716Z">
<meta property="article:author" content="Right_L">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://right-l.github.io/img/404.jpg">


<title >动力恒合仓库项目1</title>

<!-- Favicon -->

    <link href='/log.svg?v=2.1.10' rel='icon' type='image/png' sizes='16x16' ></link>


    <link href='/log.svg?v=2.1.10' rel='icon' type='image/png' sizes='32x32' ></link>


    <link href='/log.svg?v=2.1.10' rel='apple-touch-icon' sizes='180x180' ></link>



<!-- Plugin -->




    
<link rel="stylesheet" href="/css/plugins/bootstrap.row.css">

    
<link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.css">

    
    




<!-- Icon -->

    
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">




<!-- Variable -->
<script>window.ASYNC_CONFIG = {"hostname":"right-l.github.io","author":"Right_L","root":"/","typed_text":["戒骄戒躁"],"theme_version":"2.1.10","theme":{"switch":true,"default":"style-light"},"favicon":{"logo":"log.svg","icon16":"log.svg","icon32":"log.svg","appleTouchIcon":"log.svg","webmanifest":null,"visibilitychange":true,"hidden":"failure.ico","showText":"回来噜","hideText":"离开噜"},"i18n":{"placeholder":"搜索文章...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）","author":"本文作者：","copyright_link":"本文链接：","copyright_license_title":"版权声明：","copyright_license_content":"本博客所有文章除特别声明外，均默认采用 undefined 许可协议。","copy_success":"复制成功","copy_failure":"复制失败","open_read_mode":"进入阅读模式","exit_read_mode":"退出阅读模式","notice_outdate_message":"距离上次更新已经 undefined 天了, 文章内容可能已经过时。","sticky":"置顶","just":"刚刚","min":"分钟前","hour":"小时前","day":"天前","month":"个月前"},"swup":false,"plugin":{"flickr_justified_gallery":"https://unpkg.com/flickr-justified-gallery@latest/dist/fjGallery.min.js"},"icons":{"sun":"far fa-sun","moon":"far fa-moon","play":"fas fa-play","email":"far fa-envelope","next":"fas fa-arrow-right","calendar":"far fa-calendar-alt","clock":"far fa-clock","user":"far fa-user","back_top":"fas fa-arrow-up","close":"fas fa-times","search":"fas fa-search","reward":"fas fa-hand-holding-usd","user_tag":"fas fa-user-alt","toc_tag":"fas fa-th-list","read":"fas fa-book-reader","arrows":"fas fa-arrows-alt-h","double_arrows":"fas fa-angle-double-down","copy":"fas fa-copy"},"icontype":"font","highlight":{"plugin":"highlighjs","theme":true,"copy":true,"lang":false,"title":"default","height_limit":200},"toc":{"post_title":true},"live_time":{"start_time":"03/2/2024 17:00:00","prefix":"BLOG已运行 undefined 天"},"search":{"enable":true,"type":"local","href":"https://www.google.com/search?q=site:","domain":null,"path":"search.xml"}};</script>
<script id="async-page-config">window.PAGE_CONFIG = {"isPost":true,"isHome":false,"postUpdate":"2024-04-19 22:37:07"};</script>

<!-- Theme mode css -->
<link data-swup-theme rel="stylesheet" href="/css/index.css?v=2.1.10" id="trm-switch-style">
<script>
    let defaultMode = ASYNC_CONFIG.theme.default !=='auto' ?  ASYNC_CONFIG.theme.default : (window.matchMedia("(prefers-color-scheme: light)").matches ? 'style-light' : 'style-dark')
    let catchMode = localStorage.getItem('theme-mode') || defaultMode;
    let type = catchMode === 'style-dark' ? 'add' : 'remove';
    document.documentElement.classList[type]('dark')
</script>

<!-- CDN -->


    
    



<!-- Site Analytics -->
 
<meta name="generator" content="Hexo 7.1.1"></head>

<body>

  <!-- app wrapper -->
  <div class="trm-app-frame">

    <!-- page preloader -->
    <div class="trm-preloader">
    <div class="trm-holder">
        <div class="preloader">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
    <!-- page preloader end -->

    <!-- change mode preloader -->
    <div class="trm-mode-swich-animation-frame">
    <div class="trm-mode-swich-animation">
        <i class="i-sun"><i class="iconfont far fa-sun"></i></i>
        <div class="trm-horizon"></div>
        <i class="i-moon"><i class="iconfont far fa-moon"></i></i>
    </div>
</div>
    <!-- change mode preloader end -->

      <!-- scroll container -->
      <div id="trm-dynamic-content" class="trm-swup-animation">
        <div id="trm-scroll-container" class="trm-scroll-container" style="opacity: 0">
            <!-- top bar -->
            <header class="trm-top-bar">
	<div class="container">
		<div class="trm-left-side">
			<!-- logo -->
<a href="/" class="trm-logo-frame trm-anima-link">
    
        <img alt="logo" src="/log.svg">
    
    
        <div class="trm-logo-text">
            Right<span>L</span>
        </div>
    
</a>
<!-- logo end -->
		</div>
		<div class="trm-right-side">
			<!-- menu -->
<div class="trm-menu">
    <nav>
        <ul>
            
            <li class="menu-item-has-children ">
                <a  href="/" target="">
                    首页
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/archives/" target="">
                    归档
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/categories/" target="">
                    分类
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/about/" target="">
                    关于
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>
<!-- menu end -->
			
    <!-- mode switcher place -->
    <div class="trm-mode-switcher-place">
        <div class="trm-mode-switcher">
            <i class="iconfont far fa-sun"></i>
            <input class="tgl tgl-light" id="trm-swich" type="checkbox">
            <label class="trm-swich" for="trm-swich"></label>
            <i class="iconfont far fa-moon"></i>
        </div>
    </div>
    <!-- mode switcher place end -->

			
    
    <div id="trm-search-btn" class="trm-search-btn">
        <i class="iconfont fas fa-search"></i>
    </div>
     

		</div>
		<div class="trm-menu-btn">
			<span></span>
		</div>
	</div>
</header>
            <!-- top bar end -->

            <!-- body -->
            
<div class="trm-content-start">
    <!-- banner -->
    <div class="trm-banner">
    
    <!-- banner cover -->
    <img style="object-position:top;object-fit:cover;" alt="banner" class="trm-banner-cover" src="/img/banner.png">
    <!-- banner cover end -->
    

    <!-- banner content -->
    <div class="trm-banner-content trm-overlay">
        <div class="container">
            <div class="row">
                
                <div class="col-lg-12">

                    <!-- banner title -->
                    <div class="trm-banner-text trm-text-center ">
                        <div class="trm-label trm-mb-20">
                            NEWS LETTER
                        </div>
                        <h1 class="trm-mb-30 trm-hsmb-font">
                            动力恒合仓库项目1
                        </h1>

                        
                            <ul class="trm-breadcrumbs trm-label">
                                <li>
                                    <a href="/" class="trm-anima-link">Home</a>
                                </li>
                                <li>
                                    <span>
                                        2024
                                    </span>
                                </li>
                            </ul>
                        
                    </div>
                    <!-- banner title end -->

                    <!-- scroll hint -->
                    <span id="scroll-triger" class="trm-scroll-hint-frame">
                        <div class="trm-scroll-hint"></div>
                        <span class="trm-label">Scroll down</span>
                    </span>
                    <!-- scroll hint end -->

                </div>
            </div>
        </div>
    </div>
    <!-- banner content end -->
</div>
    <!-- banner end -->
    <div class="container">
        <div class="row">
            
            <div class="trm-page-content col-lg-12">
                <div id="trm-content" class="trm-content">
                    <div class="trm-post-info row hidden-sm">
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-calendar-alt trm-icon"></i><br>
            04/19
        </div>
    </div>
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-clock trm-icon"></i><br>
            22:36
        </div>
    </div>
    <div class="col-sm-4">
        <div id="post-author" class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-user trm-icon"></i><br>
            Right_L
        </div>
    </div>
</div>
<div class="trm-card ">
    <article id="article-container" class="trm-publication">
    <h1 id="基础后端搭建"><a href="#基础后端搭建" class="headerlink" title="基础后端搭建"></a>基础后端搭建</h1><h2 id="整合mybatis步骤"><a href="#整合mybatis步骤" class="headerlink" title="整合mybatis步骤"></a>整合mybatis步骤</h2><ul>
<li>引入依赖，在pom.xml中引入mysql驱动等</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis的依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件application.properties</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">warehouse_manager</span></span><br><span class="line"><span class="comment">#这里的路径和端口对应的是前端的VITE_WAREHOUSE_CONTEXT_PATH=http://localhost:9999/warehouse</span></span><br><span class="line"><span class="comment">#项目访问路径</span></span><br><span class="line"><span class="attr">server.servlet.context-path</span>=<span class="string">/warehouse</span></span><br><span class="line"><span class="comment">#访问端口</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">9999</span></span><br><span class="line"><span class="comment">#mybatis</span></span><br><span class="line"><span class="comment">#数据源</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/db_warehouse?serverTimezone=UTC</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">1114</span></span><br><span class="line"><span class="comment">#sql映射文件位置</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="comment">#实体类所在路径，包中所有实体类的别名默认是首字母小写</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.pn.entity</span></span><br><span class="line"><span class="comment">#开启驼峰</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#开启日志功能</span></span><br><span class="line"><span class="attr">mybatis.configuration-log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment">#redis</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动注解@MapperScan，mapper接口扫描器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.warehouse_manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="comment">//map接口扫描器</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.pn.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarehouseManagerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(WarehouseManagerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="redis配置"><a href="#redis配置" class="headerlink" title="redis配置"></a>redis配置</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#redis</span></span><br><span class="line"><span class="attr">spring.data.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">spring.data.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="attr">spring.data.redis.database</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>

<h2 id="token设置"><a href="#token设置" class="headerlink" title="token设置"></a>token设置</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置token时间,一个小时</span></span><br><span class="line"><span class="attr">warehouse.expire-time</span>=<span class="string">3600</span></span><br></pre></td></tr></table></figure>

<p><img src="/assets/1712918950112.png" alt="71291895011" loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<p>session不适用于分布式微服务集群项目，但是token适用。</p>
<h3 id="方法一：将token和用户信息存放在redis中，实现会话共享"><a href="#方法一：将token和用户信息存放在redis中，实现会话共享" class="headerlink" title="方法一：将token和用户信息存放在redis中，实现会话共享"></a>方法一：将token和用户信息存<strong>放在redis中</strong>，实现会话共享</h3><p><img src="/assets/1712920040752.png" alt="71292004075" loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<p>弊端：需要操作持久层，如果持久层挂了就…</p>
<h3 id="方法二：使用jwt"><a href="#方法二：使用jwt" class="headerlink" title="方法二：使用jwt"></a>方法二：使用jwt</h3><p>json web token，是一个用于通信双方之间传递信息的简洁的、安全的<strong>声明规范</strong>。</p>
<p>可以不用将token存储到数据库中，直接响应给浏览器。可以无需持久化token实现跨域认证。</p>
<blockquote>
<p>jwt是一个含签名并携带用户相关信息的加密串，客户端请求服务端的时候，请求中携带了jwt串到服务端，服务端通过签名加密匹配校验，保证信息未被篡改，校验通过之后将正常返回数据。</p>
</blockquote>
<p><img src="/assets/1712919478391.png" alt="71291947839" loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<p>jwt依赖引入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--jwt的依赖--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.18.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="token工具类"><a href="#token工具类" class="headerlink" title="token工具类"></a>token工具类</h3><p>这里将token也存储到了redis里面（做一个备份吧），但是我们是直接使用了jwt解析token信息的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.JWT;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.algorithms.Algorithm;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.JWTDecodeException;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class="line"><span class="keyword">import</span> com.pn.entity.CurrentUser;</span><br><span class="line"><span class="keyword">import</span> com.pn.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * token工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入redis模板</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入配置文件中的warehouse.expire-time属性 -- token的过期时间</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;warehouse.expire-time&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 常量:</span></span><br><span class="line"><span class="comment">     * 生成jwt</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//token中存放用户id对应的名字</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CLAIM_NAME_USERID</span> <span class="operator">=</span> <span class="string">&quot;CLAIM_NAME_USERID&quot;</span>;</span><br><span class="line">    <span class="comment">//token中存放用户名对应的名字</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CLAIM_NAME_USERCODE</span> <span class="operator">=</span> <span class="string">&quot;CLAIM_NAME_USERCODE&quot;</span>;</span><br><span class="line">    <span class="comment">//token中存放用户真实姓名对应的名字</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CLAIM_NAME_USERNAME</span> <span class="operator">=</span> <span class="string">&quot;CLAIM_NAME_USERNAME&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">sign</span><span class="params">(CurrentUser currentUser, String securityKey)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWT.create()</span><br><span class="line"><span class="comment">//              给jet载体存放用户信息，注意这里可以不指定头部，头部是固定的</span></span><br><span class="line">                .withClaim(CLAIM_NAME_USERID, currentUser.getUserId())</span><br><span class="line">                .withClaim(CLAIM_NAME_USERCODE, currentUser.getUserCode())</span><br><span class="line">                .withClaim(CLAIM_NAME_USERNAME, currentUser.getUserName())</span><br><span class="line">                .withIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())<span class="comment">//发行时间</span></span><br><span class="line">                .withExpiresAt(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + expireTime *<span class="number">1000</span>))<span class="comment">//有效时间</span></span><br><span class="line"><span class="comment">//                指定签名。传进去的是密码</span></span><br><span class="line">                .sign(Algorithm.HMAC256(securityKey));</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将当前用户信息以用户密码为密钥生成token的方法，然后将其存入redis</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">loginSign</span><span class="params">(CurrentUser currentUser, String password)</span>&#123;</span><br><span class="line">        <span class="comment">//生成token，调用上面的方法</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> sign(currentUser, password);</span><br><span class="line">        <span class="comment">//将token保存到redis中,并设置token在redis中的过期时间</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(token, token, expireTime *<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从客户端归还的token中获取用户信息的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> CurrentUser <span class="title function_">getCurrentUser</span><span class="params">(String token)</span> &#123;</span><br><span class="line"><span class="comment">//        token是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(token))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;令牌为空，请登录！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//对token进行解码,获取解码后的token</span></span><br><span class="line">        <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            decodedJWT = JWT.decode(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTDecodeException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;令牌格式错误，请登录！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从解码后的token中获取用户信息并封装到CurrentUser对象中返回</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">userId</span> <span class="operator">=</span> decodedJWT.getClaim(CLAIM_NAME_USERID).asInt();<span class="comment">//用户账号id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userCode</span> <span class="operator">=</span> decodedJWT.getClaim(CLAIM_NAME_USERCODE).asString();<span class="comment">//用户账号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> decodedJWT.getClaim(CLAIM_NAME_USERNAME).asString();<span class="comment">//用户姓名</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(userCode) || StringUtils.isEmpty(userName))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;令牌缺失用户信息，请登录！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CurrentUser</span>(userId, userCode, userName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="图片上传地址"><a href="#图片上传地址" class="headerlink" title="图片上传地址"></a>图片上传地址</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#图片上传地址</span></span><br><span class="line"><span class="attr">file.upload-path</span>=<span class="string">classpath:static/img/upload</span></span><br><span class="line"><span class="comment">#保存到数据库的地址路径</span></span><br><span class="line"><span class="attr">file.access-path</span>=<span class="string">/img/upload/</span></span><br></pre></td></tr></table></figure>

<h2 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h2><h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--验证码工具kaptcha的依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="验证码设置"><a href="#验证码设置" class="headerlink" title="验证码设置"></a>验证码设置</h3><p>在config配置类中创建java文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.impl.DefaultKaptcha;</span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.util.Config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证码工具kaptcha的配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaptchaConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置Producer接口的实现类DefaultKaptcha的bean对象,该对象用于生成验证码图片;</span></span><br><span class="line"><span class="comment">     * 并给其指定生成的验证码图片的设置项;bean对象的id引用名为captchaProducer;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;captchaProducer&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DefaultKaptcha <span class="title function_">getKaptchaBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultKaptcha</span> <span class="variable">defaultKaptcha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKaptcha</span>();</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//是否有边框 默认为true 我们可以自己设置yes，no</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.border&quot;</span>, <span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        <span class="comment">//边框颜色 默认为Color.BLACK</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.border.color&quot;</span>, <span class="string">&quot;105,179,90&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字符颜色 默认为Color.BLACK</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.color&quot;</span>, <span class="string">&quot;blue&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码图片宽度 默认为200</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.image.width&quot;</span>, <span class="string">&quot;120&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码图片高度 默认为50</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.image.height&quot;</span>, <span class="string">&quot;40&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字符大小 默认为40</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.size&quot;</span>, <span class="string">&quot;32&quot;</span>);</span><br><span class="line">        <span class="comment">//KAPTCHA_SESSION_KEY</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.session.key&quot;</span>, <span class="string">&quot;kaptchaCode&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字符间距 默认为2</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.char.space&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字符长度 默认为5</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.char.length&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字体样式 默认为new Font(&quot;Arial&quot;, 1, fontSize), new Font(&quot;Courier&quot;, 1, fontSize)</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.names&quot;</span>, <span class="string">&quot;Arial,Courier&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码噪点颜色 默认为Color.BLACK</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.noise.color&quot;</span>, <span class="string">&quot;gray&quot;</span>);</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>(properties);</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        <span class="keyword">return</span> defaultKaptcha;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证码的一些配置"><a href="#验证码的一些配置" class="headerlink" title="验证码的一些配置"></a>验证码的一些配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.impl.DefaultKaptcha;</span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.util.Config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证码工具kaptcha的配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaptchaConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置Producer接口的实现类DefaultKaptcha的bean对象,该对象用于生成验证码图片;</span></span><br><span class="line"><span class="comment">     * 并给其指定生成的验证码图片的设置项;bean对象的id引用名为captchaProducer;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;captchaProducer&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DefaultKaptcha <span class="title function_">getKaptchaBean</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">DefaultKaptcha</span> <span class="variable">defaultKaptcha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKaptcha</span>();</span><br><span class="line"><span class="comment">//验证码的各种属性</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//是否有边框 默认为true 我们可以自己设置yes，no</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.border&quot;</span>, <span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        <span class="comment">//边框颜色 默认为Color.BLACK</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.border.color&quot;</span>, <span class="string">&quot;105,179,90&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字符颜色 默认为Color.BLACK</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.color&quot;</span>, <span class="string">&quot;blue&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码图片宽度 默认为200</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.image.width&quot;</span>, <span class="string">&quot;120&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码图片高度 默认为50</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.image.height&quot;</span>, <span class="string">&quot;40&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字符大小 默认为40</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.size&quot;</span>, <span class="string">&quot;32&quot;</span>);</span><br><span class="line">        <span class="comment">//KAPTCHA_SESSION_KEY</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.session.key&quot;</span>, <span class="string">&quot;kaptchaCode&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字符间距 默认为2</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.char.space&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字符长度 默认为5</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.char.length&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码文本字体样式 默认为new Font(&quot;Arial&quot;, 1, fontSize), new Font(&quot;Courier&quot;, 1, fontSize)</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.names&quot;</span>, <span class="string">&quot;Arial,Courier&quot;</span>);</span><br><span class="line">        <span class="comment">//验证码噪点颜色 默认为Color.BLACK</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.noise.color&quot;</span>, <span class="string">&quot;gray&quot;</span>);</span><br><span class="line"><span class="comment">//把属性集对象封装给cofig</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>(properties);</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        <span class="keyword">return</span> defaultKaptcha;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用到前端"><a href="#应用到前端" class="headerlink" title="应用到前端"></a>应用到前端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.Producer;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"><span class="comment">////    注入</span></span><br><span class="line"><span class="comment">//    @Autowired</span></span><br><span class="line"><span class="comment">////    要注意不是实现类的类型，而是接口类型</span></span><br><span class="line"><span class="comment">//    private Producer producer;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//        第二种方式</span></span><br><span class="line">    <span class="meta">@Resource(name = &quot;captchaProducer&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/captcha/captchaImage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">captchaImage</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=================&quot;</span>);</span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//        生成图片文字</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> producer.createText();</span><br><span class="line"><span class="comment">//        生成图</span></span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> producer.createImage(text);</span><br><span class="line">            System.out.println(text);</span><br><span class="line"><span class="comment">//        保存到redis</span></span><br><span class="line">            redisTemplate.opsForValue().set(text, <span class="string">&quot;&quot;</span>, <span class="number">60</span> * <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line"><span class="comment">//            传入浏览器</span></span><br><span class="line">            response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">            outputStream = response.getOutputStream();</span><br><span class="line">            ImageIO.write(image, <span class="string">&quot;jpg&quot;</span>, outputStream);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (outputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    outputStream.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：</p>
<p>import jakarta.servlet.ServletOutputStream;<br>import jakarta.servlet.http.HttpServletResponse;</p>
<p>这两个原先是java.servlet，会报错！我用的是springboot3，查找资料得知：</p>
<p>SpringBoot3已经不支持javax.servlet包里的HttpSession了，<strong>如果需要使用该类的话，需要导入jakarta.servlet包里的HttpSession</strong>。</p>
</blockquote>
<h2 id="md5加密"><a href="#md5加密" class="headerlink" title="md5加密"></a>md5加密</h2><p>加密工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加密工具类 -- 提供了MD5加密算法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DigestUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">encodingCharset</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对参数数据进行MD5加密的算法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">hmacSign</span><span class="params">(String aValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hmacSign(aValue, <span class="string">&quot;warehouse&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">hmacSign</span><span class="params">(String aValue, String aKey)</span> &#123;</span><br><span class="line">        <span class="type">byte</span> k_ipad[] = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">64</span>];</span><br><span class="line">        <span class="type">byte</span> k_opad[] = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">64</span>];</span><br><span class="line">        <span class="type">byte</span> keyb[];</span><br><span class="line">        <span class="type">byte</span> value[];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            keyb = aKey.getBytes(encodingCharset);</span><br><span class="line">            value = aValue.getBytes(encodingCharset);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            keyb = aKey.getBytes();</span><br><span class="line">            value = aValue.getBytes();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Arrays.fill(k_ipad, keyb.length, <span class="number">64</span>, (<span class="type">byte</span>) <span class="number">54</span>);</span><br><span class="line">        Arrays.fill(k_opad, keyb.length, <span class="number">64</span>, (<span class="type">byte</span>) <span class="number">92</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; keyb.length; i++) &#123;</span><br><span class="line">            k_ipad[i] = (<span class="type">byte</span>) (keyb[i] ^ <span class="number">0x36</span>);</span><br><span class="line">            k_opad[i] = (<span class="type">byte</span>) (keyb[i] ^ <span class="number">0x5c</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            md = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        md.update(k_ipad);</span><br><span class="line">        md.update(value);</span><br><span class="line">        <span class="type">byte</span> dg[] = md.digest();</span><br><span class="line">        md.reset();</span><br><span class="line">        md.update(k_opad);</span><br><span class="line">        md.update(dg, <span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">        dg = md.digest();</span><br><span class="line">        <span class="keyword">return</span> toHex(dg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">toHex</span><span class="params">(<span class="type">byte</span> input[])</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(input.length * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; input.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> input[i] &amp; <span class="number">0xff</span>;</span><br><span class="line">            <span class="keyword">if</span> (current &lt; <span class="number">16</span>)</span><br><span class="line">                output.append(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            output.append(Integer.toString(current, <span class="number">16</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="响应结果封装类"><a href="#响应结果封装类" class="headerlink" title="响应结果封装类"></a>响应结果封装类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应结果封装类:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态码常量:</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//成功</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CODE_OK</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">    <span class="comment">//业务错误</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CODE_ERR_BUSINESS</span> <span class="operator">=</span> <span class="number">501</span>;</span><br><span class="line">    <span class="comment">//用户未登录</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CODE_ERR_UNLOGINED</span> <span class="operator">=</span> <span class="number">502</span>;</span><br><span class="line">    <span class="comment">//系统错误</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CODE_ERR_SYS</span> <span class="operator">=</span> <span class="number">503</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成员属性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;<span class="comment">//状态码</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;<span class="comment">//成功响应为true,失败响应为false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;<span class="comment">//响应信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object data;<span class="comment">//响应数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//成功响应的方法 -- 返回的Result中只封装了成功状态码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">ok</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(CODE_OK,<span class="literal">true</span>,<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//成功响应的方法 -- 返回的Result中封装了成功状态码和响应信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">ok</span><span class="params">(String message)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(CODE_OK,<span class="literal">true</span>,message, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//成功响应的方法 -- 返回的Result中封装了成功状态码和响应数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">ok</span><span class="params">(Object data)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(CODE_OK,<span class="literal">true</span>,<span class="literal">null</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//成功响应的方法 -- 返回的Result中封装了成功状态码和响应信息和响应数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">ok</span><span class="params">(String message, Object data)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(CODE_OK,<span class="literal">true</span>,message, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//失败响应的方法 -- 返回的Result中封装了失败状态码和响应信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">err</span><span class="params">(<span class="type">int</span> errCode, String message)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(errCode,<span class="literal">false</span>, message, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//失败响应的方法 -- 返回的Result中封装了失败状态码和响应信息和响应数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">err</span><span class="params">(<span class="type">int</span> errCode,String message,Object data)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(errCode,<span class="literal">false</span>,message, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="完整的pom-xml文件"><a href="#完整的pom-xml文件" class="headerlink" title="完整的pom.xml文件"></a>完整的pom.xml文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.pn<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>warehouse_manager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>warehouse_manager<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--web依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mybatis的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;3.5.5&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &amp;lt;!&amp;ndash; 先排除mybatis-plus和spring整合的一个类 &amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;exclusions&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                &lt;exclusion&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                &lt;/exclusion&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;/exclusions&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;3.0.3&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--redis的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--lombok的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--fastjson的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.79<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--JSR-303的依赖(数据校验)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.2.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--验证码工具kaptcha的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--pinyin4j的依赖(将汉字转成拼音的工具)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.belerweb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pinyin4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--commons-lang工具包(提供了很多工具类)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--jwt的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.18.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="完整的properties"><a href="#完整的properties" class="headerlink" title="完整的properties"></a>完整的properties</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#spring.application.name=warehouse_manager</span></span><br><span class="line"><span class="comment">#这里的路径和端口对应的是前端的VITE_WAREHOUSE_CONTEXT_PATH=http://localhost:9999/warehouse</span></span><br><span class="line"><span class="comment">#项目访问路径</span></span><br><span class="line"><span class="attr">server.servlet.context-path</span>=<span class="string">/warehouse</span></span><br><span class="line"><span class="comment">#访问端口</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">9999</span></span><br><span class="line"><span class="comment">#mybatis</span></span><br><span class="line"><span class="comment">#数据源</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/db_warehouse?serverTimezone=UTC</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">1114</span></span><br><span class="line"><span class="comment">#sql映射文件位置</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="comment">#实体类所在路径，包中所有实体类的别名默认是首字母小写</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.pn.entity</span></span><br><span class="line"><span class="comment">#开启驼峰</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#开启日志功能</span></span><br><span class="line"><span class="attr">mybatis.configuration-log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment">#redis</span></span><br><span class="line"><span class="attr">spring.data.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">spring.data.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="attr">spring.data.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#设置token时间,一小时</span></span><br><span class="line"><span class="attr">warehouse.expire-time</span>=<span class="string">3600</span></span><br><span class="line"><span class="comment">#图片上传地址</span></span><br><span class="line"><span class="attr">file.upload-path</span>=<span class="string">classpath:static/img/upload</span></span><br><span class="line"><span class="comment">#保存到数据库的地址路径</span></span><br><span class="line"><span class="attr">file.access-path</span>=<span class="string">/img/upload/</span></span><br></pre></td></tr></table></figure>

<h1 id="用户登录验证"><a href="#用户登录验证" class="headerlink" title="用户登录验证"></a>用户登录验证</h1><h2 id="mapper映射"><a href="#mapper映射" class="headerlink" title="mapper映射"></a>mapper映射</h2><p>user_info表的mapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">//user——info表的mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"><span class="comment">//    根据账号查询用户信息</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserByCode</span><span class="params">(String userCode)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.pn.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    根据账号查询用户信息</span></span><br><span class="line"><span class="comment">    public User findUserByCode(String userCode);</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByCode&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select * from user_info where user_code=#&#123;userCode&#125; and is_delete=0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类"><a href="#service类" class="headerlink" title="service类"></a>service类</h2><p>定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">//user_info表的servic接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"><span class="comment">//    根据账号查询用户的业务方法</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryUserBycode</span><span class="params">(String usercode)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现服务接口类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.pn.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.pn.service.impl.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">//注入Usermapper</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryUserBycode</span><span class="params">(String usercode)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.findUserByCode(usercode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类"><a href="#控制类" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"><span class="comment">//注入UserService,是用于根据用户信息查询</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"><span class="comment">//    注入token</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenUtils tokenUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">//点击登录按钮之后的请求</span></span><br><span class="line"><span class="comment">//    @RequestBody LoginUser loginUser接收前端传递登录的用户信息的json数据，其中，@RequestBody注解用于将HTTP请求的内容（例如JSON或XML数据）绑定到方法的参数上。</span></span><br><span class="line"><span class="comment">//    这里返回的是响应结果</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginUser loginUser)</span>&#123;</span><br><span class="line"><span class="comment">//        先校验验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">verificationCode</span> <span class="operator">=</span> loginUser.getVerificationCode();</span><br><span class="line">        <span class="keyword">if</span>(!(redisTemplate.hasKey(verificationCode)))&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;验证码错误！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        loginUser的格式如下：</span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">//   userCode:&quot;admin&quot;</span></span><br><span class="line"><span class="comment">//   userPwd:&quot;123456&quot;</span></span><br><span class="line"><span class="comment">//   verificationCode:&quot;xax4&quot;</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//        先根据账号查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.queryUserBycode(loginUser.getUserCode());</span><br><span class="line"><span class="comment">//        账号存在</span></span><br><span class="line">        <span class="keyword">if</span> (user!=<span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//         是是否审核</span></span><br><span class="line">            <span class="keyword">if</span>(user.getUserState().equals(WarehouseConstants.USER_STATE_PASS))&#123;</span><br><span class="line"><span class="comment">//             拿到从浏览器传入的密码</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">userPwd</span> <span class="operator">=</span> loginUser.getUserPwd();</span><br><span class="line"><span class="comment">//                进行md5加密</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> DigestUtil.hmacSign(userPwd);</span><br><span class="line"><span class="comment">//                判断密码是否正确</span></span><br><span class="line">                <span class="keyword">if</span>(s.equals(user.getUserPwd()))&#123;</span><br><span class="line"><span class="comment">//                    密码正确！重点！！</span></span><br><span class="line"><span class="comment">//                    需要状态码成功并且还要生成token,并且存储到了redis</span></span><br><span class="line">                    <span class="type">CurrentUser</span> <span class="variable">currentUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CurrentUser</span>(user.getUserId(),user.getUserCode(),user.getUserName());</span><br><span class="line">                    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> tokenUtils.loginSign(currentUser, userPwd);</span><br><span class="line">                    <span class="comment">//                    将这个token也响应到了前端</span></span><br><span class="line">                    <span class="keyword">return</span> Result.ok(<span class="string">&quot;登录成功！&quot;</span>,token);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;密码错误！&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;账号未审核！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        不存在</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;账号不存在！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里有一个bug就是，验证码的有效时间是3600s，也就是一个小时。上次得到的验证码只要不超过一个小时，我再输入（即便跟浏览器上显示的验证码图上的不一样），也是可以通过的。</p>
</blockquote>
<h1 id="用户登录限制"><a href="#用户登录限制" class="headerlink" title="用户登录限制"></a>用户登录限制</h1><h2 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.pn.utils.WarehouseConstants;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义的登录过滤器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogimCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRedisTemplate</span><span class="params">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) req;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) resp;</span><br><span class="line"><span class="comment">//      用于存放不需要过滤的路径</span></span><br><span class="line">        List&lt;String&gt; urlList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        urlList.add(<span class="string">&quot;/captcha/captchaImage&quot;</span>);</span><br><span class="line">        urlList.add(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line"><span class="comment">//      获取到当前访问的路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath();</span><br><span class="line"><span class="comment">//判断</span></span><br><span class="line">        <span class="keyword">if</span>(urlList.contains(servletPath))&#123;</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//      其他请求是否携带token，判断redis是否存在</span></span><br><span class="line"><span class="comment">//        拿到请求头</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(WarehouseConstants.HEADER_TOKEN_NAME);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.hasText(token)&amp;&amp;redisTemplate.hasKey(token))&#123;</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">err</span> <span class="operator">=</span> Result.err(Result.CODE_ERR_UNLOGINED, <span class="string">&quot;你尚未登录！&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonStr</span> <span class="operator">=</span> JSON.toJSONString(err);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        out.write(jsonStr);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="写配置类"><a href="#写配置类" class="headerlink" title="写配置类"></a>写配置类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.filter.LogimCheckFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"><span class="comment">//    注册原生servlet过滤器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">filterRegistrationBean</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        创建bean</span></span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">filterRegistrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line"><span class="comment">//        new自定义过滤器,这个再filter文件下写好了</span></span><br><span class="line">        <span class="type">LogimCheckFilter</span> <span class="variable">logimCheckFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogimCheckFilter</span>();</span><br><span class="line"><span class="comment">//        手动注入redis模板</span></span><br><span class="line">        logimCheckFilter.setRedisTemplate(redisTemplate);</span><br><span class="line"><span class="comment">//        注册进去</span></span><br><span class="line">        filterRegistrationBean.setFilter(logimCheckFilter);</span><br><span class="line"><span class="comment">//        指定范围</span></span><br><span class="line">        filterRegistrationBean.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="登录之后页面显示该用户名"><a href="#登录之后页面显示该用户名" class="headerlink" title="登录之后页面显示该用户名"></a>登录之后页面显示该用户名</h1><blockquote>
<p>用户名在我们的token中是有的，所以在上面的token工具类中我们是可以将token进行解析，然后获得该用户的信息。其中信息也包括了用户名！</p>
</blockquote>
<p>直接写控制类就可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前用户信息的url接口</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/curr-user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">currentUser</span><span class="params">(<span class="meta">@RequestHeader(WarehouseConstants.HEADER_TOKEN_NAME)</span> String token)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===来来========&quot;</span>);</span><br><span class="line"><span class="comment">//        解析token</span></span><br><span class="line">        <span class="type">CurrentUser</span> <span class="variable">currentUser</span> <span class="operator">=</span> tokenUtils.getCurrentUser(token);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(currentUser);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="登录页面之后加载菜单树"><a href="#登录页面之后加载菜单树" class="headerlink" title="登录页面之后加载菜单树"></a>登录页面之后加载菜单树</h1><blockquote>
<p>因为不同角色所能够使用的权限是不同的，所以其对应的菜单树也是不一样的</p>
<p>使用redis进行缓存，先从redis查看，如果没有再去数据库中找，找到后再存入redis中</p>
</blockquote>
<p>涉及到五种表：</p>
<p>①用户表②角色表③菜单表④用户与角色的中间表⑤角色与菜单的中间表</p>
<h2 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 权限表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Auth</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer authId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 父id为空或为0，表示一级权限</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> Integer parentId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String authName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String authDesc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer authGrade;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1 模块 、2  列表、 3  按钮</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String authType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String authUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String authCode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer authOrder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1 启用 、0 禁用</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String authState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer createBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer updateBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"><span class="comment">//追加属性,存放当前用户的菜单下的子级菜单</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Auth&gt; childAuth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mapper映射-1"><a href="#mapper映射-1" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Auth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthMapper</span> &#123;</span><br><span class="line"><span class="comment">//    根据userid查询用户权限下的所有菜单</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Auth&gt; <span class="title function_">findAuthByUid</span><span class="params">(Integer userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.pn.mapper.AuthMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  根据userid查出权限菜单--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAuthByUid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;auth&quot;</span>&gt;</span></span><br><span class="line">    select t3.*</span><br><span class="line">    from user_role t1,role_auth t2,auth_info t3</span><br><span class="line">    where t1.role_id=t2.role_id and t2.auth_id=t3.auth_id</span><br><span class="line">    and t3.auth_state=1 and t3.auth_type!=3</span><br><span class="line">    and t1.user_id=#&#123;userId&#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-1"><a href="#service类-1" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">//user_info表的servic接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"><span class="comment">//    根据账号查询用户的业务方法</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">queryUserBycode</span><span class="params">(String usercode)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Auth;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.mapper.AuthMapper;</span><br><span class="line"><span class="keyword">import</span> com.pn.service.AuthService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AuthService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthMapper authMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Auth&gt; <span class="title function_">authTreeByuid</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line"><span class="comment">//        先从redis中查缓存</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">authTreeJson</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;authTree:&quot;</span> + userId);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(authTreeJson)) &#123;</span><br><span class="line"><span class="comment">//            json转List&lt;Auth&gt;</span></span><br><span class="line">            List&lt;Auth&gt; authTreeList = JSON.parseArray(authTreeJson, Auth.class);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> authTreeList;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Auth&gt; allAuthList = authMapper.findAuthByUid(userId);</span><br><span class="line">        List&lt;Auth&gt; authTreeList = allAuthToAuthTree(allAuthList, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//        在redis中缓存</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;authTree:&quot;</span>+userId,JSON.toJSONString(authTreeList));</span><br><span class="line">        <span class="keyword">return</span> authTreeList;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将所有权限(菜单)转成权限(菜单)树的递归算法</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Auth&gt; <span class="title function_">allAuthToAuthTree</span><span class="params">(List&lt;Auth&gt; allAuthList, Integer pid)</span> &#123;</span><br><span class="line">        <span class="comment">//获取父权限(菜单)id为参数parentId的所有权限(菜单)</span></span><br><span class="line">        <span class="comment">//【parentId最初为0,即最初查的是所有一级权限(菜单)】</span></span><br><span class="line">        List&lt;Auth&gt; authList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Auth auth : allAuthList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (auth.getParentId().equals(pid)) &#123;</span><br><span class="line">                authList.add(auth);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查询List&lt;Auth&gt; authList中每个权限(菜单)的所有子级权限(菜单)</span></span><br><span class="line">        <span class="keyword">for</span> (Auth auth : authList) &#123;</span><br><span class="line">            List&lt;Auth&gt; childAuthList = allAuthToAuthTree(allAuthList, auth.getAuthId());</span><br><span class="line">            auth.setChildAuth(childAuthList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-1"><a href="#控制类-1" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthService authService;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/auth-list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">loadAuthTree</span><span class="params">(<span class="meta">@RequestHeader(WarehouseConstants.HEADER_TOKEN_NAME)</span> String token)</span>&#123;</span><br><span class="line"><span class="comment">//        从token中拿到userid</span></span><br><span class="line">        <span class="type">CurrentUser</span> <span class="variable">currentUser</span> <span class="operator">=</span> tokenUtils.getCurrentUser(token);</span><br><span class="line">        <span class="type">int</span> <span class="variable">userId</span> <span class="operator">=</span> currentUser.getUserId();</span><br><span class="line">        List&lt;Auth&gt; authTreeList = authService.authTreeByuid(userId);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(authTreeList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h1><blockquote>
<p>退出登录就是从redis中删除当前登录token的键就可以了</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@RequestMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">logout</span><span class="params">(<span class="meta">@RequestHeader(WarehouseConstants.HEADER_TOKEN_NAME)</span> String token)</span>&#123;</span><br><span class="line">        redisTemplate.delete(token);</span><br><span class="line"><span class="comment">//        响应</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="string">&quot;退出系统&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="分页查看用户列表"><a href="#分页查看用户列表" class="headerlink" title="分页查看用户列表"></a>分页查看用户列表</h1><h2 id="实体类-1"><a href="#实体类-1" class="headerlink" title="实体类"></a>实体类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * user_info表的实体类:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> userId;<span class="comment">//用户id</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String userCode;<span class="comment">//账号</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String userName;<span class="comment">//用户名</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String userPwd;<span class="comment">//用户密码</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String userType;<span class="comment">//用户类型</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String userState;<span class="comment">//用户状态</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String isDelete;<span class="comment">//删除状态</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> createBy;<span class="comment">//创建人</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//返回前端时,自动将Date转换成指定格式的json字符串</span></span><br><span class="line">	<span class="meta">@JsonFormat(pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date createTime;<span class="comment">//创建时间</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> updateBy;<span class="comment">//修改人</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Date updateTime;<span class="comment">//修改时间</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String getCode;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> userId, String userCode, String userName, String userPwd,</span></span><br><span class="line"><span class="params">			String userType, String userState, String isDelete, <span class="type">int</span> createBy,</span></span><br><span class="line"><span class="params">			Date createTime, <span class="type">int</span> updateBy, Date updateTime)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.userId = userId;</span><br><span class="line">		<span class="built_in">this</span>.userCode = userCode;</span><br><span class="line">		<span class="built_in">this</span>.userName = userName;</span><br><span class="line">		<span class="built_in">this</span>.userPwd = userPwd;</span><br><span class="line">		<span class="built_in">this</span>.userType = userType;</span><br><span class="line">		<span class="built_in">this</span>.userState = userState;</span><br><span class="line">		<span class="built_in">this</span>.isDelete = isDelete;</span><br><span class="line">		<span class="built_in">this</span>.createBy = createBy;</span><br><span class="line">		<span class="built_in">this</span>.createTime = createTime;</span><br><span class="line">		<span class="built_in">this</span>.updateBy = updateBy;</span><br><span class="line">		<span class="built_in">this</span>.updateTime = updateTime;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.page;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页信息实体类:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Page</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当前页码</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//每页显示行数</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//总行数</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//总页数</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//limit函数参数一每页起始行</span></span><br><span class="line">    <span class="keyword">private</span> Integer limitIndex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//存储当前页查询到的数据的List&lt;?&gt;集合</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; resultList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算总页数</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getPageCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalNum%pageSize==<span class="number">0</span> ? totalNum/pageSize : totalNum/pageSize+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算limit函数参数一每页起始行</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getLimitIndex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pageSize * (pageNum-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="mapper映射-2"><a href="#mapper映射-2" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    查询用户行数</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findRowCount</span><span class="params">(User user)</span>;</span><br><span class="line"><span class="comment">//    分页查询用户方法</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByPage</span><span class="params">(<span class="meta">@Param(&quot;page&quot;)</span>Page page,<span class="meta">@Param(&quot;user&quot;)</span> User user)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        查询用户行数--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public Integer findRowCount(User user);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findRowCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">        select count(*) from user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userCode!=null and userCode != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and user_code like concat(&#x27;%&#x27;,#&#123;userCode&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userType!=null and userType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and user_Type =#&#123;userType&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userState!=null and userState != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and user_State =#&#123;userState&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            and is_delete=0</span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        分页查询用户方法--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public List&lt;User&gt; findUserByPage(@Param(&quot;page&quot;)Page page,@Param(&quot;user&quot;) User user);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select t1.*,t2.user_code getCode</span><br><span class="line">        from user_info t1,user_info t2</span><br><span class="line">        where t1.create_by =t2.user_id and t1.is_delete=0</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.userCode!=null and user.userCode != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and t1.user_code like concat(&#x27;%&#x27;,#&#123;user.userCode&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.userType!=null and user.userType != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and t1.user_Type =#&#123;user.userType&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.userState!=null and user.userState != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and t1.user_State =#&#123;user.userState&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        order by t1.create_time desc</span><br><span class="line">        limit #&#123;page.limitIndex&#125;,#&#123;page.pageSize&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-2"><a href="#service类-2" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    分页查询用户</span></span><br><span class="line">    <span class="keyword">public</span> Page <span class="title function_">queryUserPage</span><span class="params">(Page page,User user)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Page <span class="title function_">queryUserPage</span><span class="params">(Page page, User user)</span> &#123;</span><br><span class="line"><span class="comment">//        查询用户行数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">rowCount</span> <span class="operator">=</span> userMapper.findRowCount(user);</span><br><span class="line"><span class="comment">//        分页查询所有信息</span></span><br><span class="line">        List&lt;User&gt; userByPage = userMapper.findUserByPage(page, user);</span><br><span class="line">        page.setTotalNum(rowCount);</span><br><span class="line">        page.setResultList(userByPage);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-2"><a href="#控制类-2" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.pn.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.pn.page.Page;</span><br><span class="line"><span class="keyword">import</span> com.pn.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user-list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">userList</span><span class="params">(Page page, User user)</span>&#123;</span><br><span class="line">        page = userService.queryUserPage(page, user);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h1><h2 id="mapper映射-3"><a href="#mapper映射-3" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    添加用户</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        添加用户--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int insertUser(User user);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">        insert into user_info  values(</span><br><span class="line">            null,#&#123;userCode&#125;,#&#123;userName&#125;,#&#123;userPwd&#125;,null,0,0,#&#123;createBy&#125;,now(),null,null</span><br><span class="line">        )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-3"><a href="#service类-3" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    添加用户</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">saveUser</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加用户</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">saveUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line"><span class="comment">//        添加先对账号判断是否存在</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> userMapper.findUserByCode(user.getUserCode());</span><br><span class="line">        <span class="keyword">if</span> (u!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;用户已存在！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        将密码做加密</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> DigestUtil.hmacSign(user.getUserPwd());</span><br><span class="line">        user.setUserPwd(s);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> userMapper.insertUser(user);</span><br><span class="line">        <span class="keyword">if</span> (i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(<span class="string">&quot;用户添加成功！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;添加失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-3"><a href="#控制类-3" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenUtils tokenUtils;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/addUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">addUser</span><span class="params">(<span class="meta">@RequestBody</span> User user, <span class="meta">@RequestHeader(WarehouseConstants.HEADER_TOKEN_NAME)</span>String token)</span>&#123;</span><br><span class="line"><span class="comment">//      拿到当前的用户id</span></span><br><span class="line">        <span class="type">CurrentUser</span> <span class="variable">currentUser</span> <span class="operator">=</span> tokenUtils.getCurrentUser(token);</span><br><span class="line">        <span class="type">int</span> <span class="variable">userId</span> <span class="operator">=</span> currentUser.getUserId();</span><br><span class="line">        user.setCreateBy(userId);</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> userService.saveUser(user);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="启动-禁用用户"><a href="#启动-禁用用户" class="headerlink" title="启动&#x2F;禁用用户"></a>启动&#x2F;禁用用户</h1><h2 id="mapper映射-4"><a href="#mapper映射-4" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    启动/禁用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUserState</span><span class="params">(Integer userId,String userState)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        启动/禁用--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int updateUserState(Integer userId,String userState);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserState&quot;</span>&gt;</span></span><br><span class="line">        update user_info set user_state=#&#123;param2&#125; where user_id=#&#123;param1&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-4"><a href="#service类-4" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    启动/禁用</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">updateUserState</span><span class="params">(Integer userId,String userState)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动或禁用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">updateUserState</span><span class="params">(Integer userId, String userState)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> userMapper.updateUserState(userId, userState);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(<span class="string">&quot;修改成功！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;修改失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-4"><a href="#控制类-4" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/updateState&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateUserState</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> userService.updateUserState(user.getUserId(), user.getUserState());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="分配角色"><a href="#分配角色" class="headerlink" title="分配角色"></a>分配角色</h1><h2 id="查询所有用户的角色"><a href="#查询所有用户的角色" class="headerlink" title="查询所有用户的角色"></a>查询所有用户的角色</h2><blockquote>
<p>我们使用注解版的方式将角色存入redis</p>
</blockquote>
<h3 id="在启动类添加"><a href="#在启动类添加" class="headerlink" title="在启动类添加"></a>在启动类添加</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"></span><br><span class="line"><span class="comment">//开启redis注解版缓存</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="comment">//map接口扫描器</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.pn.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarehouseManagerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(WarehouseManagerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="role实体类"><a href="#role实体类" class="headerlink" title="role实体类"></a>role实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 角色表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//implements Serializable 将 Role 对象正确地序列化，并将其存储到 Redis 缓存中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String roleDesc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String roleCode;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1 启用 0 禁用</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String roleState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer createBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer updateBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="mapper映射-5"><a href="#mapper映射-5" class="headerlink" title="mapper映射"></a>mapper映射</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Role;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleMapper</span> &#123;</span><br><span class="line"><span class="comment">//    查询所有用户的角色</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Role&gt; <span class="title function_">findAllRole</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.pn.mapper.RoleMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      查询所有用户的角色--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  public List&lt;Role&gt; findAllRole();--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllRole&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;role&quot;</span>&gt;</span></span><br><span class="line">    select * from role where role_state=1</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="service类-5"><a href="#service类-5" class="headerlink" title="service类"></a>service类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Role;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleService</span>&#123;</span><br><span class="line"><span class="comment">//    查询所有用户角色</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Role&gt; <span class="title function_">queryAllRoleo</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Role;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.mapper.RoleMapper;</span><br><span class="line"><span class="keyword">import</span> com.pn.service.RoleService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="meta">@CacheConfig(cacheNames = &quot;com.pn.service.impl.RoleServiceImpl&quot;)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">RoleService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleMapper roleMapper;</span><br><span class="line">    <span class="meta">@Cacheable(key = &quot;&#x27;all:role&#x27;&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Role&gt; <span class="title function_">queryAllRoleo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> roleMapper.findAllRole();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制类-5"><a href="#控制类-5" class="headerlink" title="控制类"></a>控制类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Role;</span><br><span class="line"><span class="keyword">import</span> com.pn.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/role&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleService roleService;</span><br><span class="line"><span class="comment">//    查询所有用户的角色</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/role-list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">roleList</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Role&gt; roles = roleService.queryAllRoleo();</span><br><span class="line">        <span class="keyword">return</span> Result.ok(roles);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询某个用户id所拥有的角色"><a href="#查询某个用户id所拥有的角色" class="headerlink" title="查询某个用户id所拥有的角色"></a>查询某个用户id所拥有的角色</h2><h3 id="mapper映射-6"><a href="#mapper映射-6" class="headerlink" title="mapper映射"></a>mapper映射</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    根据用户id查到角色列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Role&gt; <span class="title function_">findUserRoleByUid</span><span class="params">(Integer UserId)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    //    根据用户id查到角色列表--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        public List&lt;Role&gt; findUserRoleByUid(Integer UserId);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserRoleByUid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;role&quot;</span>&gt;</span></span><br><span class="line">  select t2.* from user_role t1,role t2</span><br><span class="line">  where t1.role_id=t2.role_id</span><br><span class="line">  and t1.user_id=#&#123;userId&#125;</span><br><span class="line">  and t2.role_state=1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="service类-6"><a href="#service类-6" class="headerlink" title="service类"></a>service类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    根据用户id查到角色列表</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Role&gt; <span class="title function_">queryUserRoleByUid</span><span class="params">(Integer UserId)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<blockquote>
<p>用户角色经常会变 所以不需要加入缓存中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Role&gt; <span class="title function_">queryUserRoleByUid</span><span class="params">(Integer UserId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> roleMapper.findUserRoleByUid(UserId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制类-6"><a href="#控制类-6" class="headerlink" title="控制类"></a>控制类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RoleService roleService;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    查询某个用户的角色</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user-role-list/&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">userRoleList</span><span class="params">(<span class="meta">@PathVariable</span> Integer userId)</span> &#123;</span><br><span class="line">    List&lt;Role&gt; userRoles = roleService.queryUserRoleByUid(userId);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(userRoles);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分配角色-1"><a href="#分配角色-1" class="headerlink" title="分配角色"></a>分配角色</h2><h3 id="实体类-2"><a href="#实体类-2" class="headerlink" title="实体类"></a>实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssignRoleDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; roleCheckList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="mapper映射-7"><a href="#mapper映射-7" class="headerlink" title="mapper映射"></a>mapper映射</h3><ul>
<li>根据用户id删除该用户的角色</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    分配之前应该先将该用户原有的角色进行删除</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUserRoleByUid</span><span class="params">(Integer userId)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    //    分配之前应该先将该用户原有的角色进行删除--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int deleteUserRoleByUid(Integer userId);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUserRoleByUid&quot;</span>&gt;</span></span><br><span class="line">        delete from user_role where user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>根据角色名字查找角色id</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    根据角色名来查询其对应的id</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">findRoleIdByName</span><span class="params">(String roleNmae)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  //    根据角色名来查询其对应的id--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  public Integer findRoleIdByName(String roleNmae);--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findRoleIdByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">    select role_id from role where role_name=#&#123;roleNmae&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>分配</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    根据用户的id，角色id，给用户分配角色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">assignUserRole</span><span class="params">(UserRole userRole)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    //    根据用户的id，角色id，给用户分配角色--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int assignUserRole(UserRole userRole);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;assignUserRole&quot;</span>&gt;</span></span><br><span class="line">         insert into user_role values(null,#&#123;roleId&#125;,#&#123;userId&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="service类-7"><a href="#service类-7" class="headerlink" title="service类"></a>service类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    分配角色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">assufbRole</span><span class="params">(AssignRoleDto assignRoleDto)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleMapper roleMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRoleMapper userRoleMapper;</span><br><span class="line"><span class="comment">//    要加上事务处理</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">assufbRole</span><span class="params">(AssignRoleDto assignRoleDto)</span> &#123;</span><br><span class="line"><span class="comment">//        首先先进行该用户角色的删除</span></span><br><span class="line">        userRoleMapper.deleteUserRoleByUid(assignRoleDto.getUserId());</span><br><span class="line">            List&lt;String&gt; roleNameList = assignRoleDto.getRoleCheckList();</span><br><span class="line">            <span class="keyword">for</span> (String roleNmae : roleNameList) &#123;</span><br><span class="line"><span class="comment">//                循环取出该角色的id</span></span><br><span class="line">                <span class="type">Integer</span> <span class="variable">roleId</span> <span class="operator">=</span> roleMapper.findRoleIdByName(roleNmae);</span><br><span class="line"><span class="comment">//                创建一个UserRole，存入两个id后进行添加</span></span><br><span class="line">                <span class="type">UserRole</span> <span class="variable">userRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserRole</span>();</span><br><span class="line">                userRole.setRoleId(roleId);</span><br><span class="line">                userRole.setUserId(assignRoleDto.getUserId());</span><br><span class="line"><span class="comment">//              添加</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> userRoleMapper.assignUserRole(userRole);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制类-7"><a href="#控制类-7" class="headerlink" title="控制类"></a>控制类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    给用户分配角色</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/assignRole&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">assignUserRole</span><span class="params">(<span class="meta">@RequestBody</span> AssignRoleDto assignRoleDto)</span>&#123;</span><br><span class="line">        userService.assufbRole(assignRoleDto);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="string">&quot;成功分配&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h1><h2 id="mapper映射-8"><a href="#mapper映射-8" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    删除用户</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">setIsDeleteByUids</span><span class="params">(List&lt;Integer&gt; userIdList)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    //    删除用户--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int setIsDeleteByUids(List&lt;Integer&gt; userIdList);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;setIsDeleteByUids&quot;</span>&gt;</span></span><br><span class="line">        update user_info set is_delete=1 where user_id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;userId&quot;</span>&gt;</span></span><br><span class="line">            #&#123;userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-8"><a href="#service类-8" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">deleteUserByUids</span><span class="params">(List&lt;Integer&gt; userIdList)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> userMapper.setIsDeleteByUids(userIdList);</span><br><span class="line">    <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="string">&quot;用户删除成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;用户删除失败！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-8"><a href="#控制类-8" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    删除用户(单个)</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/deleteUser/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">deleteUserById</span><span class="params">(<span class="meta">@PathVariable</span> Integer userId)</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> userService.deleteUserByUids(Arrays.asList(userId));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    删除用户（多个）</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/deleteUserList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">deleteUserByIds</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Integer&gt; userIdList)</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> userService.deleteUserByUids(userIdList);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="修改用户昵称和重置密码"><a href="#修改用户昵称和重置密码" class="headerlink" title="修改用户昵称和重置密码"></a>修改用户昵称和重置密码</h1><h2 id="mapper映射-9"><a href="#mapper映射-9" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    根据id修改用户名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">setUserNameById</span><span class="params">(User user)</span>;</span><br><span class="line"><span class="comment">//    重置密码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">setPwdById</span><span class="params">(Integer userId,String password)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    //    根据id修改用户名--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int SetUserNameById(User user);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;setUserNameById&quot;</span>&gt;</span></span><br><span class="line">        update user_info</span><br><span class="line">        set</span><br><span class="line">        user_name=#&#123;userName&#125;,update_by=#&#123;updateBy&#125;,update_time=now()</span><br><span class="line">        where user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    //    重置密码--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int setPwdById(Integer userId,String password);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;setPwdById&quot;</span>&gt;</span></span><br><span class="line">        update user_info set user_pwd=#&#123;param2&#125; where user_id=#&#123;param1&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-9"><a href="#service类-9" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    根据用户id修改用户名</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setUserById</span><span class="params">(User user)</span>;</span><br><span class="line"><span class="comment">//    重置密码</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setUserPedById</span><span class="params">(Integer userId)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//    修改用户名</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setUserById</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> userMapper.setUserNameById(user);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(<span class="string">&quot;用户修改成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;用户修改失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    重置密码</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setUserPedById</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line"><span class="comment">//加密</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> DigestUtil.hmacSign(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> userMapper.setPwdById(userId, pwd);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(<span class="string">&quot;密码重置成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;密码重置失败&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-9"><a href="#控制类-9" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    修改用户名（根据id）</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/updateUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setUserNameById</span><span class="params">(<span class="meta">@RequestBody</span> User user,<span class="meta">@RequestHeader(WarehouseConstants.HEADER_TOKEN_NAME)</span> String token)</span>&#123;</span><br><span class="line">        <span class="type">CurrentUser</span> <span class="variable">currentUser</span> <span class="operator">=</span> tokenUtils.getCurrentUser(token);</span><br><span class="line">        <span class="type">int</span> <span class="variable">userId</span> <span class="operator">=</span> currentUser.getUserId();</span><br><span class="line">        user.setUpdateBy(userId);</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> userService.setUserById(user);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    重置密码</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/updatePwd/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setUserPwdById</span><span class="params">(<span class="meta">@PathVariable</span> Integer userId)</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> userService.setUserPedById(userId);</span><br><span class="line">        <span class="keyword">return</span>  result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="分页查看角色"><a href="#分页查看角色" class="headerlink" title="分页查看角色"></a>分页查看角色</h1><h2 id="实体类-3"><a href="#实体类-3" class="headerlink" title="实体类"></a>实体类</h2><blockquote>
<p>这里的创建时间需要格式化一下时间，我使用了注解的方式</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 角色表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//implements Serializable 将 Role 对象正确地序列化，并将其存储到 Redis 缓存中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String roleDesc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String roleCode;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1 启用 0 禁用</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String roleState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer createBy;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer updateBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String getCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mapper映射-10"><a href="#mapper映射-10" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    查询角色行数</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">findRowRoleCount</span><span class="params">(Role role)</span>;</span><br><span class="line"><span class="comment">//    分页查询角色方法</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Role&gt; <span class="title function_">findRoleByPage</span><span class="params">(<span class="meta">@Param(&quot;page&quot;)</span> Page page, <span class="meta">@Param(&quot;role&quot;)</span> Role role)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        查询角色行数--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        public Integer findRowRoleCount(Role role);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findRowRoleCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">  select count(*) from role</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;roleName != null and roleName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and role_name like concat(&#x27;%&#x27;, #&#123;roleName&#125;, &#x27;%&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;roleCode != null and roleCode != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and role_code like concat(&#x27;%&#x27;, #&#123;roleCode&#125;, &#x27;%&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;roleState != null and roleState != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      and role_state = #&#123;roleState&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        分页查询角色方法--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        public List&lt;Role&gt; findRoleByPage(@Param(&quot;page&quot;) Page page, @Param(&quot;role&quot;) Role role);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findRoleByPage&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;role&quot;</span>&gt;</span></span><br><span class="line">  select t1.*, t2.user_code getCode from role t1, user_info t2</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">  and t1.create_by = t2.user_id</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;role.roleName != null and role.roleName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">    and t1.role_name like concat(&#x27;%&#x27;, #&#123;role.roleName&#125;, &#x27;%&#x27;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;role.roleCode != null and role.roleCode != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">    and t1.role_code like concat(&#x27;%&#x27;, #&#123;role.roleCode&#125;, &#x27;%&#x27;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;role.roleState != null and role.roleState != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">    and t1.role_state = #&#123;role.roleState&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  order by t1.create_time desc</span><br><span class="line">  limit #&#123;page.limitIndex&#125;,#&#123;page.pageSize&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-10"><a href="#service类-10" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询角色</span></span><br><span class="line">    <span class="keyword">public</span> Page <span class="title function_">queryRolePage</span><span class="params">(Page page,Role role)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//    分页查询角色</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Page <span class="title function_">queryRolePage</span><span class="params">(Page page, Role role)</span> &#123;</span><br><span class="line"><span class="comment">//        查询条数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">rowRoleCount</span> <span class="operator">=</span> roleMapper.findRowRoleCount(role);</span><br><span class="line"><span class="comment">//        System.out.println(rowRoleCount);</span></span><br><span class="line"><span class="comment">//        分页查询</span></span><br><span class="line">        List&lt;Role&gt; roleByPage = roleMapper.findRoleByPage(page, role);</span><br><span class="line">        page.setTotalNum(rowRoleCount);</span><br><span class="line">        page.setResultList(roleByPage);</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-10"><a href="#控制类-10" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    分页查询角色</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/role-page-list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">roleListPage</span><span class="params">(Page page, Role role)</span>&#123;</span><br><span class="line">    <span class="type">Page</span> <span class="variable">page1</span> <span class="operator">=</span> roleService.queryRolePage(page, role);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(page1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="添加角色"><a href="#添加角色" class="headerlink" title="添加角色"></a>添加角色</h1><h2 id="mapper映射-11"><a href="#mapper映射-11" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    添加角色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertRole</span><span class="params">(Role role)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  //    添加角色--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  public int insertRole(Role role);--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertRole&quot;</span>&gt;</span></span><br><span class="line">    insert into role values (</span><br><span class="line">        null,#&#123;roleName&#125;,#&#123;roleDesc&#125;,#&#123;roleCode&#125;,0,#&#123;createBy&#125;,now(),null,null</span><br><span class="line">    )</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-11"><a href="#service类-11" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    添加角色</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">savaRole</span><span class="params">(Role role)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<blockquote>
<p>添加之后记得要清除缓存！</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@CacheEvict(key = &quot;&#x27;all:role&#x27;&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">savaRole</span><span class="params">(Role role)</span> &#123;</span><br><span class="line"><span class="comment">//        先进行判断角色是否存在</span></span><br><span class="line">        <span class="type">Role</span> <span class="variable">roleByNameOrCode</span> <span class="operator">=</span> roleMapper.findRoleByNameOrCode(role.getRoleName(), role.getRoleCode());</span><br><span class="line">        <span class="keyword">if</span>(roleByNameOrCode!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;角色已存在！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> roleMapper.insertRole(role);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(<span class="string">&quot;角色添加成功！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;角色已存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-11"><a href="#控制类-11" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> TokenUtils tokenUtils;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//添加角色</span></span><br><span class="line"> <span class="meta">@RequestMapping(&quot;/role-add&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> Result <span class="title function_">saveRole</span><span class="params">(<span class="meta">@RequestBody</span> Role role, <span class="meta">@RequestHeader(WarehouseConstants.HEADER_TOKEN_NAME)</span> String token)</span> &#123;</span><br><span class="line">     <span class="type">CurrentUser</span> <span class="variable">currentUser</span> <span class="operator">=</span> tokenUtils.getCurrentUser(token);</span><br><span class="line">     <span class="type">int</span> <span class="variable">createBy</span> <span class="operator">=</span> currentUser.getUserId();</span><br><span class="line">     role.setCreateBy(createBy);</span><br><span class="line">     <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> roleService.savaRole(role);</span><br><span class="line">     <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h1 id="删除角色"><a href="#删除角色" class="headerlink" title="删除角色"></a>删除角色</h1><h2 id="mapper映射-12"><a href="#mapper映射-12" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    删除角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeRoleById</span><span class="params">(Integer RoleId)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    //    删除角色--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int removeRoleById(Integer RoleId);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;removeRoleById&quot;</span>&gt;</span></span><br><span class="line">        delete from role where role_id=#&#123;RoleId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-12"><a href="#service类-12" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    删除角色</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">removeRole</span><span class="params">(Integer roleId)</span>;</span><br></pre></td></tr></table></figure>

<p>实现（将redis的缓存删除）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    删除角色</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleAuthMapper roleAuthMapper;</span><br><span class="line">    <span class="meta">@CacheEvict(key = &quot;&#x27;all:role&#x27;&quot;)</span></span><br><span class="line"><span class="comment">//    开启事务</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">removeRole</span><span class="params">(Integer roleId)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> roleMapper.removeRoleById(roleId);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            roleAuthMapper.removeRoleAuthByRid(roleId);</span><br><span class="line">            <span class="keyword">return</span> Result.ok(<span class="string">&quot;角色删除成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;角色删除失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-12"><a href="#控制类-12" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//    删除角色</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/role-delete/&#123;roleId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">deleteRole</span><span class="params">(<span class="meta">@PathVariable</span> Integer roleId)</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> roleService.removeRole(roleId);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="查看所有权限菜单树以及该角色拥有的权限菜单树"><a href="#查看所有权限菜单树以及该角色拥有的权限菜单树" class="headerlink" title="查看所有权限菜单树以及该角色拥有的权限菜单树"></a>查看所有权限菜单树以及该角色拥有的权限菜单树</h1><h2 id="mapper映射-13"><a href="#mapper映射-13" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    查询所有权限菜单</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Auth&gt; <span class="title function_">findAllAuth</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    根据角色id获取权限id</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findAuthIdByRid</span><span class="params">(Integer roleId)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    //    查询所有权限菜单--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public List&lt;Auth&gt; findAllAuth();--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllAuth&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;auth&quot;</span>&gt;</span></span><br><span class="line">        select * from auth_info where auth_state=1 and auth_type!=3</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  //    根据角色id获取权限id--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  public List&lt;Integer&gt; findAuthIdByRid(Integer roleId);--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAuthIdByRid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">        select auth_id from role_auth where role_id =#&#123;roleId&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-13"><a href="#service类-13" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    查找所有权限菜单树</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Auth&gt; <span class="title function_">allAuthTree</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    查询角色中的权限id</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">queryRoleAuthId</span><span class="params">(Integer roleId)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//查找所有权限的菜单树</span></span><br><span class="line"><span class="comment">//    指定缓存的键</span></span><br><span class="line">    <span class="meta">@Cacheable(key = &quot;&#x27;all:authTree&#x27;&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Auth&gt; <span class="title function_">allAuthTree</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//        先查所有权限菜单</span></span><br><span class="line">        List&lt;Auth&gt; allAuthList = authMapper.findAllAuth();</span><br><span class="line"><span class="comment">//        转成菜单树</span></span><br><span class="line">        List&lt;Auth&gt; authTreeList = allAuthToAuthTree(allAuthList, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> authTreeList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    查询角色中的权限id</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">queryRoleAuthId</span><span class="params">(Integer roleId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> roleAuthMapper.findAuthIdByRid(roleId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-13"><a href="#控制类-13" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Auth;</span><br><span class="line"><span class="keyword">import</span> com.pn.entity.Result;</span><br><span class="line"><span class="keyword">import</span> com.pn.service.AuthService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/auth&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthService authService;</span><br><span class="line"><span class="comment">//    响应所有权限的菜单树</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/auth-tree&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">LoadAllAuth</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Auth&gt; allAuth = authService.allAuthTree();</span><br><span class="line">        <span class="keyword">return</span> Result.ok(allAuth);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    查看该角色的菜单表</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/role-auth&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">roleAuth</span><span class="params">(Integer roleId)</span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(&quot;id是&quot;);</span></span><br><span class="line"><span class="comment">//        System.out.println(roleId);</span></span><br><span class="line">        List&lt;Integer&gt; authList = roleService.queryRoleAuthId(roleId);</span><br><span class="line"><span class="comment">//        System.out.println(&quot;=============&quot;);</span></span><br><span class="line"><span class="comment">//        System.out.println(authList);</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(authList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="修改角色权限"><a href="#修改角色权限" class="headerlink" title="修改角色权限"></a>修改角色权限</h1><h2 id="实体类-4"><a href="#实体类-4" class="headerlink" title="实体类"></a>实体类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接收给角色分配的请求json数据的dto类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssignAuthDto</span> &#123;</span><br><span class="line"><span class="comment">//    角色id</span></span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line"><span class="comment">//    权限id</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; authIds;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mapper映射-14"><a href="#mapper映射-14" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pn.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pn.entity.UserRole;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRoleMapper</span> &#123;</span><br><span class="line"><span class="comment">//    分配之前应该先将该用户原有的角色进行删除</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUserRoleByUid</span><span class="params">(Integer userId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    根据用户的id，角色id，给用户分配角色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">assignUserRole</span><span class="params">(UserRole userRole)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.pn.mapper.UserRoleMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    //    分配之前应该先将该用户原有的角色进行删除--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int deleteUserRoleByUid(Integer userId);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUserRoleByUid&quot;</span>&gt;</span></span><br><span class="line">        delete from user_role where user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    //    根据用户的id，角色id，给用户分配角色--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public int assignUserRole(UserRole userRole);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;assignUserRole&quot;</span>&gt;</span></span><br><span class="line">         insert into user_role values(null,#&#123;roleId&#125;,#&#123;userId&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-14"><a href="#service类-14" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    分配角色的权限</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveRoleAuth</span><span class="params">(AssignAuthDto assignAuthDto)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    分配角色的权限</span></span><br><span class="line"><span class="comment">//    开启事务</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveRoleAuth</span><span class="params">(AssignAuthDto assignAuthDto)</span> &#123;</span><br><span class="line"><span class="comment">//        先删除该角色的所有权限</span></span><br><span class="line">        roleAuthMapper.removeRoleAuthByRid(assignAuthDto.getRoleId());</span><br><span class="line"><span class="comment">//分配角色</span></span><br><span class="line">        List&lt;Integer&gt; authList = assignAuthDto.getAuthIds();</span><br><span class="line">        <span class="keyword">for</span> (Integer authId:authList)&#123;</span><br><span class="line">            <span class="type">RoleAuth</span> <span class="variable">roleAuth</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleAuth</span>();</span><br><span class="line">            roleAuth.setRoleId(assignAuthDto.getRoleId());</span><br><span class="line">            roleAuth.setAuthId(authId);</span><br><span class="line">            roleAuthMapper.insertRoleAuth(roleAuth);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-14"><a href="#控制类-14" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    给角色分配权限</span></span><br><span class="line"><span class="comment">//    传来的是json串数据&#123;roleId: &quot;17&quot;, authIds: [61, 62]&#125;</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/auth-grant&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">grantAuth</span><span class="params">(<span class="meta">@RequestBody</span> AssignAuthDto assignAuthDto)</span>&#123;</span><br><span class="line">        roleService.saveRoleAuth(assignAuthDto);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="string">&quot;权限分配成功&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="修改角色描述"><a href="#修改角色描述" class="headerlink" title="修改角色描述"></a>修改角色描述</h1><h2 id="mapper映射-15"><a href="#mapper映射-15" class="headerlink" title="mapper映射"></a>mapper映射</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改角色描述</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="type">int</span> <span class="title function_">setDescByRid</span><span class="params">(Role role)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    //修改角色描述--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    public  int setDescByRid(Role role);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;setDescByRid&quot;</span>&gt;</span></span><br><span class="line">        update role set role_desc=#&#123;roleDesc&#125;,update_by=#&#123;updateBy&#125;,update_time=now()</span><br><span class="line">        where role_id=#&#123;roleId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="service类-15"><a href="#service类-15" class="headerlink" title="service类"></a>service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    修改角色描述</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setRoleByRid</span><span class="params">(Role role)</span>;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    修改角色描述</span></span><br><span class="line"><span class="meta">@CacheEvict(key = &quot;&#x27;all:role&#x27;&quot;)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">setRoleByRid</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> roleMapper.setDescByRid(role);</span><br><span class="line">    <span class="keyword">if</span>(i&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="string">&quot;角色描述修改成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.err(Result.CODE_ERR_BUSINESS,<span class="string">&quot;角色描述修改失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="控制类-15"><a href="#控制类-15" class="headerlink" title="控制类"></a>控制类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    修改角色描述</span></span><br><span class="line"><span class="comment">//    传来的还是json&#123;roleId: 18, roleName: &quot;测试&quot;, roleDesc: &quot;&quot;&#125;</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/role-update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">updateRoleMs</span><span class="params">(<span class="meta">@RequestBody</span> Role role,<span class="meta">@RequestHeader(WarehouseConstants.HEADER_TOKEN_NAME)</span> String token)</span>&#123;</span><br><span class="line">        <span class="type">CurrentUser</span> <span class="variable">currentUser</span> <span class="operator">=</span> tokenUtils.getCurrentUser(token);</span><br><span class="line">        <span class="type">int</span> <span class="variable">updateUserId</span> <span class="operator">=</span> currentUser.getUserId();</span><br><span class="line">        role.setUpdateBy(updateUserId);</span><br><span class="line">        <span class="keyword">return</span> roleService.setRoleByRid(role);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>




</article>
    
    

</div>
<div class="trm-post-next-prev row">
    <div class="col-lg-12">
        <!-- title -->
        <h5 class="trm-title-with-divider">
            其他文章
            <span data-number="02"></span>
        </h5>
    </div>
    
    
        <div class="col-lg-6">
    <div class="trm-older-publications-card trm-scroll-animation trm-active-el">
        <div class="trm-older-publication">
            
            <a class="trm-op-top trm-anima-link" href="/2024/03/25/docker/">
                <span class="trm-op-cover">
                    <img alt="cover" class="no-fancybox" src="/img/block.jpg">
                </span>
                <h6 class="trm-op-title">Docker</h6>
            </a>
            <div class="trm-divider trm-mb-15 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>24/03/25</li>
                <li>15:45</li>
                <li>学习笔记</li>
            </ul>
        </div>
    </div>
</div>
    
</div>

    



                    <div class="trm-divider footer-divider"></div>

                    <!-- footer -->
                    <footer class="trm-scroll-animation">

    

    

      

    
        <div class="trm-footer-item blog-run-long"></div>
     

     
</footer>
                    <!-- footer end -->

                </div>
            </div>
        </div>
    </div>
</div>
            <!-- body end -->

            

    <div id="post-toc" class="trm-post-toc">
      <div class="trm-post-toc-header">
        目录导航
				<span id="post-toc-top">
					置顶
				</span>
      </div>
      <div class="trm-post-toc-content">
        <ol class="trm-toc"><li class="trm-toc-item trm-toc-level-1" title="基础后端搭建"><a rel="nofollow" class="trm-toc-link" href="#基础后端搭建"><span class="trm-toc-number">1.</span> <span class="trm-toc-text">基础后端搭建</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="整合mybatis步骤"><a rel="nofollow" class="trm-toc-link" href="#整合mybatis步骤"><span class="trm-toc-number">1.1.</span> <span class="trm-toc-text">整合mybatis步骤</span></a></li><li class="trm-toc-item trm-toc-level-2" title="redis配置"><a rel="nofollow" class="trm-toc-link" href="#redis配置"><span class="trm-toc-number">1.2.</span> <span class="trm-toc-text">redis配置</span></a></li><li class="trm-toc-item trm-toc-level-2" title="token设置"><a rel="nofollow" class="trm-toc-link" href="#token设置"><span class="trm-toc-number">1.3.</span> <span class="trm-toc-text">token设置</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="方法一：将token和用户信息存放在redis中，实现会话共享"><a rel="nofollow" class="trm-toc-link" href="#方法一：将token和用户信息存放在redis中，实现会话共享"><span class="trm-toc-number">1.3.1.</span> <span class="trm-toc-text">方法一：将token和用户信息存放在redis中，实现会话共享</span></a></li><li class="trm-toc-item trm-toc-level-3" title="方法二：使用jwt"><a rel="nofollow" class="trm-toc-link" href="#方法二：使用jwt"><span class="trm-toc-number">1.3.2.</span> <span class="trm-toc-text">方法二：使用jwt</span></a></li><li class="trm-toc-item trm-toc-level-3" title="token工具类"><a rel="nofollow" class="trm-toc-link" href="#token工具类"><span class="trm-toc-number">1.3.3.</span> <span class="trm-toc-text">token工具类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="图片上传地址"><a rel="nofollow" class="trm-toc-link" href="#图片上传地址"><span class="trm-toc-number">1.4.</span> <span class="trm-toc-text">图片上传地址</span></a></li><li class="trm-toc-item trm-toc-level-2" title="验证码"><a rel="nofollow" class="trm-toc-link" href="#验证码"><span class="trm-toc-number">1.5.</span> <span class="trm-toc-text">验证码</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="导入依赖"><a rel="nofollow" class="trm-toc-link" href="#导入依赖"><span class="trm-toc-number">1.5.1.</span> <span class="trm-toc-text">导入依赖</span></a></li><li class="trm-toc-item trm-toc-level-3" title="验证码设置"><a rel="nofollow" class="trm-toc-link" href="#验证码设置"><span class="trm-toc-number">1.5.2.</span> <span class="trm-toc-text">验证码设置</span></a></li><li class="trm-toc-item trm-toc-level-3" title="验证码的一些配置"><a rel="nofollow" class="trm-toc-link" href="#验证码的一些配置"><span class="trm-toc-number">1.5.3.</span> <span class="trm-toc-text">验证码的一些配置</span></a></li><li class="trm-toc-item trm-toc-level-3" title="应用到前端"><a rel="nofollow" class="trm-toc-link" href="#应用到前端"><span class="trm-toc-number">1.5.4.</span> <span class="trm-toc-text">应用到前端</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="md5加密"><a rel="nofollow" class="trm-toc-link" href="#md5加密"><span class="trm-toc-number">1.6.</span> <span class="trm-toc-text">md5加密</span></a></li><li class="trm-toc-item trm-toc-level-2" title="响应结果封装类"><a rel="nofollow" class="trm-toc-link" href="#响应结果封装类"><span class="trm-toc-number">1.7.</span> <span class="trm-toc-text">响应结果封装类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="完整的pom.xml文件"><a rel="nofollow" class="trm-toc-link" href="#完整的pom-xml文件"><span class="trm-toc-number">1.8.</span> <span class="trm-toc-text">完整的pom.xml文件</span></a></li><li class="trm-toc-item trm-toc-level-2" title="完整的properties"><a rel="nofollow" class="trm-toc-link" href="#完整的properties"><span class="trm-toc-number">1.9.</span> <span class="trm-toc-text">完整的properties</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="用户登录验证"><a rel="nofollow" class="trm-toc-link" href="#用户登录验证"><span class="trm-toc-number">2.</span> <span class="trm-toc-text">用户登录验证</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射"><span class="trm-toc-number">2.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类"><span class="trm-toc-number">2.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类"><span class="trm-toc-number">2.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="用户登录限制"><a rel="nofollow" class="trm-toc-link" href="#用户登录限制"><span class="trm-toc-number">3.</span> <span class="trm-toc-text">用户登录限制</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="自定义过滤器"><a rel="nofollow" class="trm-toc-link" href="#自定义过滤器"><span class="trm-toc-number">3.1.</span> <span class="trm-toc-text">自定义过滤器</span></a></li><li class="trm-toc-item trm-toc-level-2" title="写配置类"><a rel="nofollow" class="trm-toc-link" href="#写配置类"><span class="trm-toc-number">3.2.</span> <span class="trm-toc-text">写配置类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="登录之后页面显示该用户名"><a rel="nofollow" class="trm-toc-link" href="#登录之后页面显示该用户名"><span class="trm-toc-number">4.</span> <span class="trm-toc-text">登录之后页面显示该用户名</span></a></li><li class="trm-toc-item trm-toc-level-1" title="登录页面之后加载菜单树"><a rel="nofollow" class="trm-toc-link" href="#登录页面之后加载菜单树"><span class="trm-toc-number">5.</span> <span class="trm-toc-text">登录页面之后加载菜单树</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="实体类"><a rel="nofollow" class="trm-toc-link" href="#实体类"><span class="trm-toc-number">5.1.</span> <span class="trm-toc-text">实体类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-1"><span class="trm-toc-number">5.2.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-1"><span class="trm-toc-number">5.3.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-1"><span class="trm-toc-number">5.4.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="退出登录"><a rel="nofollow" class="trm-toc-link" href="#退出登录"><span class="trm-toc-number">6.</span> <span class="trm-toc-text">退出登录</span></a></li><li class="trm-toc-item trm-toc-level-1" title="分页查看用户列表"><a rel="nofollow" class="trm-toc-link" href="#分页查看用户列表"><span class="trm-toc-number">7.</span> <span class="trm-toc-text">分页查看用户列表</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="实体类"><a rel="nofollow" class="trm-toc-link" href="#实体类-1"><span class="trm-toc-number">7.1.</span> <span class="trm-toc-text">实体类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-2"><span class="trm-toc-number">7.2.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-2"><span class="trm-toc-number">7.3.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-2"><span class="trm-toc-number">7.4.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="添加用户"><a rel="nofollow" class="trm-toc-link" href="#添加用户"><span class="trm-toc-number">8.</span> <span class="trm-toc-text">添加用户</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-3"><span class="trm-toc-number">8.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-3"><span class="trm-toc-number">8.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-3"><span class="trm-toc-number">8.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="启动&#x2F;禁用用户"><a rel="nofollow" class="trm-toc-link" href="#启动-禁用用户"><span class="trm-toc-number">9.</span> <span class="trm-toc-text">启动&#x2F;禁用用户</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-4"><span class="trm-toc-number">9.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-4"><span class="trm-toc-number">9.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-4"><span class="trm-toc-number">9.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="分配角色"><a rel="nofollow" class="trm-toc-link" href="#分配角色"><span class="trm-toc-number">10.</span> <span class="trm-toc-text">分配角色</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="查询所有用户的角色"><a rel="nofollow" class="trm-toc-link" href="#查询所有用户的角色"><span class="trm-toc-number">10.1.</span> <span class="trm-toc-text">查询所有用户的角色</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="在启动类添加"><a rel="nofollow" class="trm-toc-link" href="#在启动类添加"><span class="trm-toc-number">10.1.1.</span> <span class="trm-toc-text">在启动类添加</span></a></li><li class="trm-toc-item trm-toc-level-3" title="role实体类"><a rel="nofollow" class="trm-toc-link" href="#role实体类"><span class="trm-toc-number">10.1.2.</span> <span class="trm-toc-text">role实体类</span></a></li><li class="trm-toc-item trm-toc-level-3" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-5"><span class="trm-toc-number">10.1.3.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-3" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-5"><span class="trm-toc-number">10.1.4.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-3" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-5"><span class="trm-toc-number">10.1.5.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="查询某个用户id所拥有的角色"><a rel="nofollow" class="trm-toc-link" href="#查询某个用户id所拥有的角色"><span class="trm-toc-number">10.2.</span> <span class="trm-toc-text">查询某个用户id所拥有的角色</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-6"><span class="trm-toc-number">10.2.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-3" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-6"><span class="trm-toc-number">10.2.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-3" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-6"><span class="trm-toc-number">10.2.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="分配角色"><a rel="nofollow" class="trm-toc-link" href="#分配角色-1"><span class="trm-toc-number">10.3.</span> <span class="trm-toc-text">分配角色</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="实体类"><a rel="nofollow" class="trm-toc-link" href="#实体类-2"><span class="trm-toc-number">10.3.1.</span> <span class="trm-toc-text">实体类</span></a></li><li class="trm-toc-item trm-toc-level-3" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-7"><span class="trm-toc-number">10.3.2.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-3" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-7"><span class="trm-toc-number">10.3.3.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-3" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-7"><span class="trm-toc-number">10.3.4.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="删除用户"><a rel="nofollow" class="trm-toc-link" href="#删除用户"><span class="trm-toc-number">11.</span> <span class="trm-toc-text">删除用户</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-8"><span class="trm-toc-number">11.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-8"><span class="trm-toc-number">11.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-8"><span class="trm-toc-number">11.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="修改用户昵称和重置密码"><a rel="nofollow" class="trm-toc-link" href="#修改用户昵称和重置密码"><span class="trm-toc-number">12.</span> <span class="trm-toc-text">修改用户昵称和重置密码</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-9"><span class="trm-toc-number">12.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-9"><span class="trm-toc-number">12.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-9"><span class="trm-toc-number">12.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="分页查看角色"><a rel="nofollow" class="trm-toc-link" href="#分页查看角色"><span class="trm-toc-number">13.</span> <span class="trm-toc-text">分页查看角色</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="实体类"><a rel="nofollow" class="trm-toc-link" href="#实体类-3"><span class="trm-toc-number">13.1.</span> <span class="trm-toc-text">实体类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-10"><span class="trm-toc-number">13.2.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-10"><span class="trm-toc-number">13.3.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-10"><span class="trm-toc-number">13.4.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="添加角色"><a rel="nofollow" class="trm-toc-link" href="#添加角色"><span class="trm-toc-number">14.</span> <span class="trm-toc-text">添加角色</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-11"><span class="trm-toc-number">14.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-11"><span class="trm-toc-number">14.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-11"><span class="trm-toc-number">14.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="删除角色"><a rel="nofollow" class="trm-toc-link" href="#删除角色"><span class="trm-toc-number">15.</span> <span class="trm-toc-text">删除角色</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-12"><span class="trm-toc-number">15.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-12"><span class="trm-toc-number">15.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-12"><span class="trm-toc-number">15.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="查看所有权限菜单树以及该角色拥有的权限菜单树"><a rel="nofollow" class="trm-toc-link" href="#查看所有权限菜单树以及该角色拥有的权限菜单树"><span class="trm-toc-number">16.</span> <span class="trm-toc-text">查看所有权限菜单树以及该角色拥有的权限菜单树</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-13"><span class="trm-toc-number">16.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-13"><span class="trm-toc-number">16.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-13"><span class="trm-toc-number">16.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="修改角色权限"><a rel="nofollow" class="trm-toc-link" href="#修改角色权限"><span class="trm-toc-number">17.</span> <span class="trm-toc-text">修改角色权限</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="实体类"><a rel="nofollow" class="trm-toc-link" href="#实体类-4"><span class="trm-toc-number">17.1.</span> <span class="trm-toc-text">实体类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-14"><span class="trm-toc-number">17.2.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-14"><span class="trm-toc-number">17.3.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-14"><span class="trm-toc-number">17.4.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="修改角色描述"><a rel="nofollow" class="trm-toc-link" href="#修改角色描述"><span class="trm-toc-number">18.</span> <span class="trm-toc-text">修改角色描述</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="mapper映射"><a rel="nofollow" class="trm-toc-link" href="#mapper映射-15"><span class="trm-toc-number">18.1.</span> <span class="trm-toc-text">mapper映射</span></a></li><li class="trm-toc-item trm-toc-level-2" title="service类"><a rel="nofollow" class="trm-toc-link" href="#service类-15"><span class="trm-toc-number">18.2.</span> <span class="trm-toc-text">service类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="控制类"><a rel="nofollow" class="trm-toc-link" href="#控制类-15"><span class="trm-toc-number">18.3.</span> <span class="trm-toc-text">控制类</span></a></li></ol></li></ol>
      </div>
    </div>

            
<div class="trm-fixed-container">
    
        <div class="trm-fixed-btn post-toc-btn" data-title="目录">
            <i class="iconfont fas fa-th-list"></i>
        </div>
    
    
        <div class="trm-fixed-btn" data-title="阅读模式" onclick="asyncFun.switchReadMode()">
            <i class="iconfont fas fa-book-reader"></i>
        </div>
    
    
    <div id="trm-back-top" class="trm-fixed-btn" data-title="回到顶部">
        <i class="iconfont fas fa-arrow-up"></i>
    </div>
</div>
        </div>
      </div>
      <!-- scroll container end -->
  </div>
  <!-- app wrapper end -->

  
    <div class="trm-search-popup">
        <div class="trm-search-wrapper">
            <div class="form trm-search-form">
                <div class="trm-search-input-icon">
                    <i class="iconfont fas fa-search"></i>
                </div>
                <input class="trm-search-input" type="text" placeholder="搜索文章...">
                <div class="trm-search-btn-close">
                    <i class="iconfont fas fa-times"></i>
                </div>
            </div>
            <div class="trm-search-result-container">
                <div class="trm-search-empty">
                    请输入关键词进行搜索
                </div>
            </div>
            <div class="trm-search-footer">
                <div class="trm-search-stats"></div>
                <ul class="trm-search-commands">
                    <li>
                        <kbd class="command-palette-commands-key">
                            <svg width="15" height="15" aria-label="Escape key" role="img">
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="1.2">
                                    <path
                                        d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993 0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016.8634 0 1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5c.032.5663-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864 0 1.6425 1.031 1.5443 2.2492h-2.956">
                                    </path>
                                </g>
                            </svg>
                        </kbd>
                        <span class="command-palette-Label">to close</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

  <!-- Plugin -->




    
    
<script src="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

    

    
        <script src="/js/plugins/typing.js?v=2.1.10"></script>
    

    
        
<script src="https://unpkg.com/hexo-generator-searchdb@1.4.0/dist/search.js"></script>

        <script src="/js/plugins/local_search.js?v=2.1.10"></script>
    

    <!-- 数学公式 -->
    

    <!-- 评论插件 -->
    
        

        
    



<!-- CDN -->


    

    

    




    <!-- Service Worker -->
    
    <!-- baidu push -->
    


<script id="async-script" src="/js/main.js?v=2.1.10"></script>

</body>

</html>